<!DOCTYPE html>
{% load static %}
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>비료사용처방</title>
  <meta name="viewport" content="width=1024,user-scalable=no">
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <link rel="stylesheet" href="{% static 'fertilizer/css/prescription.css' %}">
  <script src="{% static 'fertilizer/js/prescription.js' %}"></script>
</head>
<body>
  {% csrf_token %}
  <div class="container">
    <nav>
      <a class="nav-link" href="{% url 'main-index' %}">홈</a> |
      <a class="nav-link" href="{% url 'water:water' %}">물사용처방</a> |
      <span class="nav-menu">
        <a class="nav-link" href="javascript:void(0)">비료사용처방</a>
        <div class="dropdown-content">
          <a class="dropdown-link" href="{% url 'fertilizer:prescription' %}">비료사용처방</a>
          <a class="dropdown-link" href="{% url 'fertilizer:experience' %}">비료사용처방 체험하기</a>
          <a class="dropdown-link" href="{% url 'fertilizer:standard' %}">비료 표준사용량 처방</a>
        </div>
      </span>
    </nav>

    <h1>비료사용처방</h1>

    <div class="notice-text">
      ※ 해당서비스는 최근 5년 내 토양검정을 받은 필지를 조회하여 비료사용처방서를 확인할 수 있습니다.
    </div>

    <div class="form-box">
      <!-- 지역 선택 -->
      <div>
        <label style="font-weight: bold;">· 지역</label>
        <select id="sido_cd">
            <option value="">광역시/도</option>
            <option value="51">강원특별자치도</option>
            <option value="41">경기도</option>
            <option value="48">경상남도</option>
            <option value="47">경상북도</option>
            <option value="29">광주광역시</option>
            <option value="27">대구광역시</option>
            <option value="30">대전광역시</option>
            <option value="26">부산광역시</option>
            <option value="11">서울특별시</option>
            <option value="36">세종특별자치시</option>
            <option value="31">울산광역시</option>
            <option value="28">인천광역시</option>
            <option value="46">전라남도</option>
            <option value="52">전북특별자치도</option>
            <option value="50">제주특별자치도</option>
            <option value="44">충청남도</option>
            <option value="43">충청북도</option>
        </select>
        <select id="sgg_cd">
          <option value="">시/군/구</option>
        </select>
        <select id="umd_cd">
          <option value="">읍/면/동</option>
        </select>
        <select id="ri_cd">
          <option value="">리</option>
        </select>
      </div>

      <!-- 지번/토양검정일자 (초기에는 숨김) -->
      <div id="address-complete-section" style="display: none;">
        <div>
          <label style="font-weight: bold;">· 지번선택</label>
          <select id="sel_jibn" disabled>
            <option value="">지번선택</option>
          </select>
        </div>
        <div>
          <label style="font-weight: bold;">· 토양검정일자</label>
          <select id="exam_day_search" disabled>
            <option value="">토양검정일자</option>
          </select>
        </div>
      </div>

      <!-- 작물 선택 -->
      <div>
        <label style="font-weight: bold;">· 작물</label>
          <select id="crop_type">
            <option value="">작물유형 선택</option>
            <option value="00">곡류(벼)</option>
            <option value="01">곡류(기타)</option>
            <option value="02">유지류</option>
            <option value="03">서류</option>
            <option value="04">과채류</option>
            <option value="05">근채류</option>
            <option value="06">인경채류</option>
            <option value="07">경엽채류</option>
            <option value="08">산채류</option>
            <option value="09">과수</option>
            <option value="10">약용작물</option>
            <option value="11">화훼류</option>
            <option value="14">사료작물</option>
            <option value="12">기타</option>
          </select>
          <select id="crop_code">
            <option value="">작물 선택</option>
          </select>
          <!-- 곡류(벼) 선택시에만 표시되는 품질 선택 -->
          <select id="rice_fert" class="select-box" style="display: none;">
            <option value="">- 품질 선택 -</option>
            <option value="1">고품질쌀(9kg)</option>
            <option value="2">최고쌀(7kg)</option>
            <option value="3">보통쌀(11kg)</option>
          </select>
          <button type="button" class="btn-crop-search">작물명검색</button>
      </div>

      <!-- 벼 선택시에만 표시되는 안내문구 -->
      <div style="display: none; color: red; font-size: 12px; margin-top: 5px; margin-left: 120px;" id="rice-notice">
        ※ 벼 질소시비량 계산시 유효규산 최대 180mg/kg 적용.
      </div>

      <!-- 벼 선택시에만 표시되는 유기자재 처방 옵션 -->
      <div style="display: none;" id="organic-option">
        <div class="form-row">
          <label class="form-label"></label>
          <div class="form-input-group">
            <input type="radio" id="organicAt1" name="organicAt" value="Y">
            <label for="organicAt1">유기자재 처방</label>
            <input type="radio" id="organicAt2" name="organicAt" value="N" checked>
            <label for="organicAt2">일반 처방</label>
          </div>
        </div>
      </div>

      <div>
        <button id="search" class="button">
          <span class="icon"></span>검색
        </button>
      </div>
    </div>

    <!-- 화학성 평균 결과 출력 영역 (검색 버튼 바로 아래) -->
    <div id="chemical-average-area"></div>

    <!-- 결과 출력 영역 -->
    <div id="result-area"></div>

    <!-- 처방서 보기 및 초기화 버튼 영역 -->
    <div id="prescription-buttons" style="display: none; margin: 20px 0; text-align: center;">
      <div class="btn_wrap_b">
        <button id="prescription-preview" class="button colorOrange" style="margin-right: 10px;">처방서 보기</button>
        <button id="reset-form" class="button colorWhite">초기화</button>
      </div>
    </div>

    <!-- 처방서 모달 -->
    <div id="prescription-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3000; overflow-y: auto;">
      <div style="background: white; max-width: 900px; margin: 20px auto; border-radius: 8px; overflow: hidden;">
        <div style="padding: 20px; border-bottom: 1px solid #eee; background: #f8f9fa;">
          <h2 style="margin: 0; font-size: 24px; text-align: center;">📋 비료사용 임시처방서</h2>
        </div>
        <div id="prescription-content" style="padding: 20px; max-height: 70vh; overflow-y: auto;">
          <!-- 처방서 내용이 여기에 들어갑니다 -->
        </div>
        <div style="padding: 15px 20px; border-top: 1px solid #eee; text-align: center; background: #f8f9fa;">
          <button id="prescription-close" style="padding: 10px 20px; background: #6D4C41; color: white; border: none; cursor: pointer; border-radius: 4px;">닫기</button>
        </div>
      </div>
    </div>

    <!-- 로딩 오버레이 -->
    <div id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
      <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 8px;">
        <div style="text-align: center;">검색 중...</div>
      </div>
    </div>
  </div>

  <!-- JavaScript에서 사용할 기본 데이터 -->
  <script>
    // 작물 타입 매핑
    const cropTypes = {
      "00": "곡류(벼)", "01": "곡류(기타)", "02": "유지류", "03": "서류",
      "04": "과채류", "05": "근채류", "06": "인경채류", "07": "경엽채류",
      "08": "산채류", "09": "과수", "10": "약용작물", "11": "화훼류",
      "14": "사료작물", "12": "기타"
    };

    // 벼 품질 매핑
    const riceQuality = {
      "1": "고품질쌀(9kg)",
      "2": "최고쌀(7kg)",
      "3": "보통쌀(11kg)"
    };

    // 지역 매핑
    const sidoOptions = {
      "51": "강원특별자치도", "41": "경기도", "48": "경상남도", "47": "경상북도",
      "29": "광주광역시", "27": "대구광역시", "30": "대전광역시", "26": "부산광역시",
      "11": "서울특별시", "36": "세종특별자치시", "31": "울산광역시", "28": "인천광역시",
      "46": "전라남도", "52": "전북특별자치도", "50": "제주특별자치도", "44": "충청남도", "43": "충청북도"
    };

    // 전역 변수 - 처방서에서 사용할 데이터 저장
    let currentPrescriptionData = null;
  </script>
</body>
</html>