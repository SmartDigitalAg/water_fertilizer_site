<!DOCTYPE html>
{% load static %}
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>흙토람 - 노지 밭 물사용 처방</title>
  <style>
    .container { max-width: 900px; margin: 0 auto; padding: 1em;
      border: 1px solid #e0e0e0;   /* <== 외곽선 추가! */
      border-radius: 0;             /* 각진 스타일 원하면 0, 둥글게 하려면 10px 정도로 */}
    nav { margin-bottom: 1em; }
    .nav-menu { display: inline-block; position: relative; }
    .nav-link, .dropdown-link {
      color: #222; text-decoration: none; padding: 4px 13px; font-size: 1.03em;
      transition: background 0.15s;
    }
    .nav-link:hover, .dropdown-link:hover {
      background: #f5eee5; color: #222; border-radius: 6px;
    }
    .dropdown-content {
      display: none; position: absolute; left: 0; min-width: 190px; background: #fff;
      box-shadow: 0 6px 18px 0 rgba(120,30,180,0.11); border: 1px solid #dedede;
      border-radius: 8px; z-index: 100; padding: 0.3em 0;
    }
    .dropdown-content a {
      display: block; padding: 12px 18px; font-size: 1em; white-space: nowrap;
      color: #222; background: transparent; transition: background 0.17s, color 0.17s;
    }
    .dropdown-content a:hover { background: #f5eee5; color: #222; }
    .nav-menu:hover .dropdown-content {
      display: block; animation: slideDown 0.18s cubic-bezier(.38,.1,.49,.94);
    }

    .form-box {
      background: #faf9f7;
      border: 1px solid #e0e0e0;
      padding: 1.2em 1.5em;
      margin-bottom: 1.4em;
      border-radius: 0;
    }

    @keyframes slideDown { from { opacity: 0; transform: translateY(-12px);} to { opacity: 1; transform: translateY(0);} }
    .form-row { margin: 0.5em 0; }
    select, input[type="date"], input[type="text"] { border:1px solid #bcb69e; background:#fff; height:38px;  font-size:1em; padding:0 10px;
      min-width:110px; margin-right:0.5em; box-sizing:border-box; }
    .button { padding: 0.4em 1em; border: none; background: #6c615e; color: #fff; cursor: pointer; }
    .button.default { background: #ccc; color: #333; }
    .info { color: red; margin-top: 0.5em; }
    table { width: 100%; border-collapse: collapse; margin-top: 1em; }
    th, td { border: 1px solid #aaa; padding: 0.5em; text-align: center; }
    #report { margin-top: 2em; }
    @media (max-width: 600px) {
      nav { font-size: 0.98em; }
      .dropdown-content { min-width: 145px; }
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
  $(function(){
    // 데이터 정의
    const sidoList = { '51':'강원특별자치도', '41':'경기도', '45':'전북특별자치도' };
    const sggMap = {
      '51':['춘천시','원주시','강릉시'],
      '41':['수원시','성남시','안산시'],
      '45':['완주군','익산시','정읍시']
    };
    const cropMap = {
      '01':['옥수수','콩','보리'],
      '02':['땅콩','참깨'],
      '03':['감자','고구마']
    };
    const stageInfoMap = {
      '유묘기':         { period:'10/10~10/31', waterTon:5.25, dailyTon:0.19 },
      '분얼기':         { period:'11/01~12/10', waterTon:5.77, dailyTon:0.14 },
      '생육재생기':     { period:'02/10~02/28', waterTon:6.26, dailyTon:0.21 },
      '분얼 및 신장기': { period:'03/01~04/20', waterTon:22.17, dailyTon:0.43 },
      '출수 및 등숙기': { period:'04/21~05/10', waterTon:10.95, dailyTon:0.55 }
    };
    // 초기 콤보박스 세팅
    $('#sido').append(
      Object.entries(sidoList).map(([val, name]) => `<option value="${val}">${name}</option>`)
    );
    // 시군구 연동
    $('#sido').on('change', function(){
      const arr = sggMap[$(this).val()] || [];
      $('#sgg').html('<option value="">시군구 선택</option>')
        .append(arr.map(n => `<option>${n}</option>`));
    });
    // 작물 연동
    $('#crop_gbn').on('change', function(){
      const arr = cropMap[$(this).val()] || [];
      $('#crop').html('<option value="">작물</option>')
        .append(arr.map(n => `<option>${n}</option>`));
    });
    // 권장 파종 시기 표시
    $('#exam_day').on('change', function(){
      const d = $(this).val() || '―';
      $('#recommended').text('권장 파종·정식시기: ' + d);
    });
    // 검색 클릭: 요약/상세 테이블 생성
    $('#search').on('click', function(){
      const D = id => $(`#${id} option:selected`).text() || $(`#${id}`).val() || '-';
      $('#result').html(`
        <table>
          <thead>
            <tr>
              <th>시도</th><th>시군구</th><th>작물</th>
              <th>파종·정식시기</th><th>기상정보</th>
              <th>관수방법</th><th>관수면적(㎡)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>${D('sido')}</td>
              <td>${D('sgg')}</td>
              <td>${D('crop')}</td>
              <td>${$('#exam_day').val() || '-'}</td>
              <td>${D('weather')}</td>
              <td>${D('irrigation')}</td>
              <td>${$('#area').val() || '-'}</td>
            </tr>
          </tbody>
        </table>
      `);
      // 상세 리포트
      let totalW = 0, totalD = 0, rows = '';
      $.each(stageInfoMap, (s, v) => {
        totalW += v.waterTon; totalD += v.dailyTon;
        rows += `<tr>
          <td>${s}</td>
          <td>${v.period}</td>
          <td>${v.waterTon.toFixed(2)}</td>
          <td>${v.dailyTon.toFixed(2)}</td>
        </tr>`;
      });
      rows += `<tr>
        <td>계</td><td></td>
        <td>${totalW.toFixed(2)}</td>
        <td>${totalD.toFixed(2)}</td>
      </tr>`;
      $('#report').html(`
        <table>
          <thead>
            <tr>
              <th>생육단계</th>
              <th>생육기간<br>(월/일)</th>
              <th>물 필요량<br>(톤/100m²)</th>
              <th>일별 물 필요량<br>(톤/day)</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `);
    });
    // 초기화
    $('#reset').on('click', function(){
      $('#sido').val('');
      $('#sgg, #crop').html('<option value="">선택</option>');
      $('#crop_gbn, #exam_day, #weather, #irrigation, #area').val('');
      $('#recommended').text('권장 파종·정식시기: ―');
      $('#result, #report').empty();
    });
  });
  </script>
</head>
<body>
  <div class="container">
    <!-- nav -->
    <nav>
      <a class="nav-link" href="{% url 'main-index' %}">홈</a> |
      <a class="nav-link" href="{% url 'water:water' %}">물사용처방</a> |
      <span class="nav-menu">
        <a class="nav-link" href="javascript:void(0)">비료사용처방</a>
        <div class="dropdown-content">
          <a class="dropdown-link" href="{% url 'fertilizer:prescription' %}">비료사용처방</a>
          <a class="dropdown-link" href="{% url 'fertilizer:experience' %}">비료사용처방 체험하기</a>
          <a class="dropdown-link" href="{% url 'fertilizer:standard' %}">비료 표준사용량 처방</a>
        </div>
      </span>
    </nav>
    <!-- //nav -->

    <h1>노지 밭 물사용 처방</h1>

    <form id="water-form" onsubmit="return false;">
      <div class="form-box">
        <div class="form-row">
          <label>· 지역</label>
          <select id="sido"><option value="">선택</option></select>
          <select id="sgg"><option value="">시군구 선택</option></select>
          <button type="button" class="button default">지도에서 선택</button>
        </div>
        <div class="form-row">
          <label>· 작물</label>
          <select id="crop_gbn">
            <option value="">작물분류</option>
            <option value="01">곡류</option>
            <option value="02">유지작물</option>
            <option value="03">서류</option>
          </select>
          <select id="crop"><option value="">작물</option></select>
        </div>
        <div class="form-row">
          <label>· 파종·정식시기</label>
          <input type="date" id="exam_day" />
          <span id="recommended">권장 파종·정식시기: ―</span>
        </div>
        <div class="form-row">
          <label>· 기상정보</label>
          <select id="weather">
            <option value="">평년선택</option>
            <option>최근3년</option>
            <option>최근10년</option>
          </select>
        </div>
        <div class="form-row">
          <label>· 관수방법</label>
          <select id="irrigation">
            <option value="">관수방법</option>
            <option>점적관수</option>
            <option>스프링클러</option>
            <option>분수호스</option>
            <option>고랑관수</option>
          </select>
        </div>
        <div class="form-row">
          <label>· 노지밭면적(m²)</label>
          <input type="text" id="area" style="width:80px;" />
        </div>
        <div class="info">* 기상정보 데이터 산정에 따라 조회내용표출이 다소 지연될 수 있습니다.</div>
        <div class="form-row">
          <button type="button" id="search" class="button">검색</button>
          <button type="reset" id="reset" class="button default">초기화</button>
        </div>
      </div>
    </form>

    <div id="result"></div>
    <div id="report"></div>
  </div>
</body>
</html>
